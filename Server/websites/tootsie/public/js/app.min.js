function unix2timestamp(e){return moment.unix(e).format("L @ h:mm A")}function copy(e){let a=$(`#${e}`).text();if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(a);else{let e=$("<textarea>",{style:"position: fixed; top: 0; width: 2em; height: 2em; padding: 0; border: none; outline: none; boxShadow: none; background: transparent"});e.append(a),$(document.body).append(e),e.focus(),e.select();try{document.execCommand("copy")}catch(e){console.log(`failed to copy text ${a} because ${e}`)}e.remove()}}function fetchApplicationDataModify(e=!1){e||($("#data").addClass("d-none"),$("#data-loading").removeClass("d-none"));let a=$("#data-body");a.html(""),$("#data-empty").hasClass("d-none")||$("#data-empty").addClass("d-none"),fetch(`${window.rboxlo.domain}/games/application/json`).then(e=>e.json()).then(e=>{0==e.length?($("#data-loading").addClass("d-none"),$("#data-empty").removeClass("d-none")):($(e).each((e,t)=>{let n=$("<tr>",{"data-rboxlo-application-id":t.id}),d=$("<td>",{class:"align-middle text-center table-button",scope:"row"}).append($("<a>",{href:`${window.rboxlo.domain}/games/application/modify?id=${t.id}`}).append($("<button>",{class:"btn btn-primary btn-sm",type:"button"}).append($("<i>",{class:"fas fa-pencil"})))),s=$("<td>",{class:"align-middle text-center table-button",scope:"row"}).append($("<button>",{class:"btn btn-danger btn-sm",type:"button",onclick:`window.rboxlo.currentlyDeleting=${t.id}`,"data-bs-toggle":"modal","data-bs-target":"#deleteApplicationModal"}).append($("<i>",{class:"fas fa-trash"}))),l=$("<td>",{class:"align-middle text-center table-button",scope:"row"}).append($("<a>",{class:"btn btn-success btn-sm text-white",type:"button",href:`${window.rboxlo.domain}/games/application/deployment?id=${t.id}`}).append($("<i>",{class:"fas fa-upload"}))),o=$("<td>",{class:"align-middle text-center"}).append(t.id),i=$("<td>",{class:"align-middle"}).append($("<div>",{class:"d-flex justify-content-between align-items-center"}).append([$("<code>",{id:`data-uuid-${t.id}`}).append(t.uuid),$("<button>",{class:"btn btn-secondary btn-sm",onclick:`copy('data-uuid-${t.id}')`}).append($("<i>",{class:"fas fa-clipboard"}))])),p=$("<td>",{class:"align-middle"});t.last_deployed_version_uuid.length>0?p.append($("<div>",{class:"d-flex justify-content-between align-items-center"}).append([$("<code>",{id:`data-lastVersionUUID-${t.id}`}).append(t.last_deployed_version_uuid),$("<button>",{class:"btn btn-secondary btn-sm",onclick:`copy('data-lastVersionUUID-${t.id}')`}).append($("<i>",{class:"fas fa-clipboard"}))])):p.append($("<div>",{class:"d-flex justify-content-between align-items-center"}).append([$("<i>",{class:"text-muted"}).append("none"),$("<button>",{class:"btn btn-secondary btn-sm",disabled:""}).append($("<i>",{class:"fas fa-clipboard"}))]));let r=$("<td>",{class:"align-middle"}).append($("<div>",{class:"d-flex justify-content-between align-items-center"}).append([$("<code>",{id:`data-internalName-${t.id}`}).append(t.internal_name),$("<button>",{class:"btn btn-secondary btn-sm",onclick:`copy('data-internalName-${t.id}')`}).append($("<i>",{class:"fas fa-clipboard"}))])),c=$("<td>",{class:"align-middle"}).append(t.display_name),m=$("<td>",{class:"align-middle"}).append(unix2timestamp(t.last_updated_timestamp)),u=$("<td>",{class:"align-middle"}).append(unix2timestamp(t.created_timestamp));n.append(d),n.append(s),n.append(l),n.append(o),n.append(i),n.append(p),n.append(r),n.append(c),n.append(m),n.append(u),a.append(n)}),setTimeout(()=>{$("#data-loading").addClass("d-none"),$("#data").removeClass("d-none")},200))})}function regenUUIDModify(){let e=$("#spinner-uuid");e.removeClass("d-none");let a=$('meta[name="rboxlo-application-id"]').attr("content"),t=$('meta[name="rboxlo-csrf"]').attr("content");fetch(`${window.rboxlo.domain}/games/application/regen-uuid`,{method:"POST",body:new URLSearchParams({id:a,_csrf:t})}).then(e=>e.json()).then(a=>{e.addClass("d-none");let t=$("#modification-update");a.success?(t.hasClass("alert-danger")&&(t.removeClass("alert-danger"),t.addClass("alert-success")),t.text("Successfully regenerated application UUID!"),t.removeClass("d-none"),t.removeAttr("style"),$("#uuid").text(a.newUUID),$("#lastUpdated").text(unix2timestamp(moment().unix()))):(t.hasClass("alert-success")&&(t.removeClass("alert-success"),t.addClass("alert-danger")),t.text("Unknown error occurred"),t.removeClass("d-none"),t.removeAttr("style")),setTimeout(()=>{t.fadeOut("slow")},3250)})}function saveEditDisplayNameChanges(){let e=$("#spinner-editDisplayNameChanges"),a=$("#editDisplayNameModal"),t=$("#displayNameModalText"),n=$("#internalNameModalError"),d=$("#displayName"),s=$("#modification-update");n.hasClass("d-none")||n.addClass("d-none"),e.removeClass("d-none");let l=$('meta[name="rboxlo-application-id"]').attr("content"),o=$('meta[name="rboxlo-csrf"]').attr("content"),i=$("#editDisplayNameInput");if(0==i.val().length)return n.hasClass("alert-success")&&(n.removeClass("alert-success"),n.addClass("alert-danger")),n.text("The new display name must not be empty."),void n.removeClass("d-none");fetch(`${window.rboxlo.domain}/games/application/update-display-name`,{method:"POST",body:new URLSearchParams({id:l,_csrf:o,name:i.val()})}).then(e=>e.json()).then(l=>{e.addClass("d-none"),l.success?(s.hasClass("alert-danger")&&(s.removeClass("alert-danger"),s.addClass("alert-success")),s.text("Successfully updated display name!"),s.removeClass("d-none"),s.removeAttr("style"),i.val(""),t.text(l.newName),d.text(l.newName),$("#displayNameHeader").text(l.newName),$("#lastUpdated").text(unix2timestamp(moment().unix())),setTimeout(()=>{s.fadeOut("slow")},2250),a.modal("toggle")):(n.hasClass("alert-success")&&(n.removeClass("alert-success"),n.addClass("alert-danger")),n.text("Unknown error occurred"),n.removeClass("d-none"))})}function saveEditInternalNameChanges(){let e=$("#spinner-editInternalNameChanges"),a=$("#editInternalNameModal"),t=$("#internalNameModalText"),n=$("#internalNameModalError"),d=$("#internalName"),s=$("#modification-update");n.hasClass("d-none")||n.addClass("d-none"),e.removeClass("d-none");let l=$('meta[name="rboxlo-application-id"]').attr("content"),o=$('meta[name="rboxlo-csrf"]').attr("content"),i=$("#editInternalNameInput");if(0==i.val().length)return n.hasClass("alert-success")&&(n.removeClass("alert-success"),n.addClass("alert-danger")),n.text("The new internal name must not be empty."),void n.removeClass("d-none");fetch(`${window.rboxlo.domain}/games/application/update-internal-name`,{method:"POST",body:new URLSearchParams({id:l,_csrf:o,name:i.val()})}).then(e=>e.json()).then(l=>{e.addClass("d-none"),l.success?(s.hasClass("alert-danger")&&(s.removeClass("alert-danger"),s.addClass("alert-success")),s.text("Successfully updated internal name!"),s.removeClass("d-none"),s.removeAttr("style"),i.val(""),t.text(l.newName),d.text(l.newName),$("#lastUpdated").text(unix2timestamp(moment().unix())),setTimeout(()=>{s.fadeOut("slow")},2250),a.modal("toggle")):(n.hasClass("alert-success")&&(n.removeClass("alert-success"),n.addClass("alert-danger")),n.text("Unknown error occurred"),n.removeClass("d-none"))})}function deleteApplication(){let e,a=window.rboxlo.hasOwnProperty("currentlyDeleting"),t=$('meta[name="rboxlo-csrf"]').attr("content");e=a?parseInt(window.rboxlo.currentlyDeleting):$('meta[name="rboxlo-application-id"]').attr("content"),fetch(`${window.rboxlo.domain}/games/application/delete-api`,{method:"POST",body:new URLSearchParams({id:e,_csrf:t})}).then(e=>e.json()).then(t=>{if(t.success)if(a){let a=$("#modification-update");$(`[data-rboxlo-application-id="${e}"`).remove(),a.text(`Successfully deleted application "${t.name}"!`),a.removeClass("d-none"),a.removeAttr("style"),$("#deleteApplicationModal").modal("hide"),refreshData(),setTimeout(()=>{a.fadeOut("slow")},2250)}else window.location.href=`${window.rboxlo.domain}/games/application/modify`})}function fetchApplicationDataDelete(e=!1){e||($("#data").addClass("d-none"),$("#data-loading").removeClass("d-none"));let a=$("#data-body");a.html(""),$("#data-empty").hasClass("d-none")||$("#data-empty").addClass("d-none"),fetch(`${window.rboxlo.domain}/games/application/json`).then(e=>e.json()).then(e=>{0==e.length?($("#data-loading").addClass("d-none"),$("#data-empty").removeClass("d-none")):($(e).each((e,t)=>{let n=$("<tr>",{"data-rboxlo-application-id":t.id,onclick:`deleteListClicked(${t.id})`,style:"cursor: pointer"}),d=$("<td>",{class:"align-middle text-center"}).append(t.id),s=$("<td>",{class:"align-middle"}).append($("<code>").append(t.uuid)),l=$("<td>",{class:"align-middle"});t.last_deployed_version_uuid.length>0?l.append($("<code>").append(t.last_deployed_version_uuid)):l.append($("<i>",{class:"text-muted"}).append("none"));let o=$("<td>",{class:"align-middle"}).append($("<code>").append(t.internal_name)),i=$("<td>",{class:"align-middle"}).append(t.display_name),p=$("<td>",{class:"align-middle"}).append(unix2timestamp(t.last_updated_timestamp)),r=$("<td>",{class:"align-middle"}).append(unix2timestamp(t.created_timestamp));n.append(d),n.append(s),n.append(l),n.append(o),n.append(i),n.append(p),n.append(r),a.append(n)}),setTimeout(()=>{$("#data-loading").addClass("d-none"),$("#data").removeClass("d-none")},200))})}function deleteListClicked(e){window.rboxlo.currentlyDeleting=e,$("#deleteApplicationModal").modal("show")}window.rboxlo=[],$(document).ready(()=>{let e=$("[laid]");e.each((e,a)=>{a=$(a),a.attr("laid")==window.rboxlo.laid&&(a.addClass("active"),a.find("a").addClass("text-white"))})});